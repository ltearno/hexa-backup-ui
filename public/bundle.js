!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){const i="/public/",n="home.lteconsulting.fr"==window.location.hostname?"https://home.lteconsulting.fr":"https://localhost:5005",a=document.querySelector.bind(document),s=document.querySelectorAll.bind(document);let l="true"===localStorage.getItem("EXTENDED");a("#extended").checked=l;let r="true"===localStorage.getItem("STREAM_RAW_VIDEO");a("#stream-raw-video").checked=r;let o="true"===localStorage.getItem("SHOW_FULL_COMMIT_HISTORY");a("#show-full-commit-history").checked=o;let c="true"===localStorage.getItem("SHOW_UNLIKED_ITEMS");a("#show-unliked-items").checked=c;let d=localStorage.getItem("SORT_ORDER")||"name";a("#display-order").value=d;let u=null,h=null,m=-1,f=-1,p=-1,y=[],g={},$=[],v=[],w=[],b=null,T=null,S=null,k=l,D=d,I=r,E=o,M=c;const H=e=>new Promise(t=>{setTimeout(()=>{t()},e)}),O={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},x=e=>e?("number"==typeof e?new Date(e):e).toLocaleString("fr",O):null;let j=null;const W=()=>{let e=`${h}#${u}`;m>=0&&(e+=`-${m}`),e!=j&&(j=e,history.pushState({currentDirectoryDescriptorSha:h,currentClientId:u,currentPictureIndex:m},`directory ${h}`,`${i}#${h}${m>=0?`-${m}`:""}`))};let _=[],N=e=>{const t=()=>a("#status").innerHTML=_.join("<br>");let i=!1,n=setTimeout(()=>{_.push(e),i=!0,t()},500);return()=>{clearTimeout(n),i&&(_=_.filter(t=>t!=e),t(),i=!1)}};async function C(e){a("#directories").innerHTML="";let t=N(`refreshing ${e.length} directories...`),n=e.sort((e,t)=>{let i=e.name.toLocaleLowerCase(),n=t.name.toLocaleLowerCase();return i.localeCompare(n)}).map(e=>{let t=`<a href='#' class='small' onclick='event.preventDefault() || showParents("${e.contentSha}")'>[..]</a>`;return l?`<div><span class='small'>${x(e.lastWrite)} ${e.contentSha?e.contentSha.substr(0,7):"-"}</span> <a href='#' onclick='event.preventDefault() || goDirectory("${e.contentSha}")'>${e.name}</a>${t}</div>`:`<div><a href='${i}#${e.contentSha}' onclick='event.preventDefault() || goDirectory("${e.contentSha}")'>${e.name}</a> ${t}</div>`});n.length?(a("#directories").classList.remove("is-hidden"),a("#directories").innerHTML=`<h2>Directories <small>(${n.length})</small></h2><div id='directories-container'>${n.join("")}</div>`):a("#directories").classList.add("is-hidden"),t()}function R(e){const t=(e,t)=>{let i=e.fileName.toLocaleLowerCase(),n=t.fileName.toLocaleLowerCase();return i.localeCompare(n)},i=(e,t)=>e.lastWrite==t.lastWrite?0:e.lastWrite>t.lastWrite?1:-1,n=(e,n)=>{let a=t(e,n);return a||i(e,n)},a=(e,n)=>{let a=i(e,n);return a||t(e,n)};let s=null;switch(D){case"name":s=n;break;case"date":s=a}return e.sort(s)}async function P(e){if(a("#directories").innerHTML="",a("#files").innerHTML="",a("#images").innerHTML="",!e)return;let t=N(`loading directory descriptor ${e.substr(0,7)}...`),i=await async function(e){let t=await fetch(`${n}/sha/${e}/content?type=text/json`);return await t.json()}(e);if(t(),!i||!i.files)return void(a("#directories").innerHTML=`error fetching ${e}`);let s=i.files;C(s.filter(e=>e.isDirectory));let l=[],r=[],o=[];y=R(y=s.filter(e=>!e.isDirectory).map(e=>({sha:e.contentSha,mimeType:z(e.name),fileName:e.name,lastWrite:1*e.lastWrite,size:1*e.size}))),await U(),y.forEach(e=>{e.mimeType.startsWith("image/")&&l.push(e),e.mimeType.startsWith("video/")&&r.push(e),e.mimeType.startsWith("audio/")&&o.push(e)}),f=-1,w=o,await J(),await H(1),$=l,await V(),p=-1,v=r}let A=null;function z(e){let t=e.lastIndexOf(".");if(t>=0){let i=e.substr(t+1).toLocaleLowerCase();if(i in MimeTypes)return MimeTypes[i]}return"application/octet-stream"}async function J(){a("#video-player").classList.add("is-hidden");let e=0,t=0,i="",s=N(`refreshing ${y.length} files...`);for(let a=0;a<y.length;a++){const s=y[a];let r=["application/octet-stream"];"application/octet-stream"!=s.mimeType&&r.push(s.mimeType);const o=(e,t)=>{let i=`${n}/sha/${s.sha}/content?type=${e}`;return t&&(i+=`&fileName=${s.fileName}`),i};let c="",d="",u=[],h=null;s.mimeType.startsWith("audio/")?(u.push(`audio-${e}`),h=`listenAudio(${e})`,c=`<a href='#' onclick='event.preventDefault() || listenAudio(${e})'>üé∂ ‚ñ∂</a> `,e++):s.mimeType.startsWith("video/")&&(u.push(`video-${t}`),h=`showVideo(${t})`,c=`<a href='#' onclick='event.preventDefault() || showVideo(${t})'>üéûÔ∏è ‚ñ∂</a> `,t++);let m=`<a class='like' onclick='event.preventDefault() || toggleLikeFile(${a})'>[like ‚ô°]</a>`,f=`<a href='#' onclick='event.preventDefault() || addToPlaylist(${a})'>[+]</a>`,p=`<a href='#' onclick='event.preventDefault() || showParents("${s.sha}")'>[..]</a>`;if(l){let e=r.map((e,t)=>{const i=(()=>l?e:0==t?"dl":e.indexOf("/")<0?e:e.substr(e.indexOf("/")+1))();return`[<a href='${o(e,!0)}'>${i}</a>]`}).join(" ");d=`${`<span class='small'>${x(s.lastWrite)} ${s.sha?s.sha.substr(0,7):"-"}</span>`} <a href='#' onclick='event.preventDefault() || ${h}'>${s.fileName}</a> <span class='small'>${s.size} ${e} ${p} ${m} ${f}</span>`}else{let e=s.fileName.substr("".length),t="",i=[];if(i.push(p),h){let n=e.lastIndexOf(".");n&&(e=e.substr(0,n)),t=`href='#' onclick='event.preventDefault() || ${h}'`,i.push(`<a href='${o(r[r.length-1],!1)}'>[dl]</a>`)}else t=`href='${o(r[r.length-1],!1)}'`;if(i.push(m),i.push(f),d=`<a ${t}>${e}</a> <span class='small'>${i.join(" ")}</span>`,"date"==D){d=`<span class='small'>${x(s.lastWrite)}</span>`+" "+d}}i+=`<div id='file-${a}' class='${u.join(" ")}'>${c}${d}</div>`,a%200==199&&await H(15)}i.length?(a("#files").classList.remove("is-hidden"),a("#files").innerHTML=`<h2>Files <small>(${y.length})</small></h2><div id="files-container">${i}</div> `):a("#files").classList.add("is-hidden"),await async function(){for(let e in y){let t=y[e],i=g[t.sha];i&&i.status&&a(`#file-${e}`).classList.add("liked")}}(),s()}async function U(){let e=[...new Set(y.map(e=>e.sha))];g={};let t=0;for(;t<e.length;){let i=Math.min(20,e.length-t),a=await(await fetch(`${n}/metadata/likes-sha?q=${JSON.stringify({shaList:e.slice(t,t+i)})}`)).json();t+=i,a&&Object.getOwnPropertyNames(a).forEach(e=>g[e]=a[e])}}async function V(){A&&(A(),A=null),$.length?(a("#images-container").classList.remove("is-hidden"),a("#images").innerHTML="",A=function(e,t,i,n){let a=0,s=5,l=!1,r=null;return async function(){if(!e||!e.length)return;const o=()=>n.lastChild.offsetTop-i.offsetHeight/1<=i.scrollTop+i.offsetHeight,c=e=>{if(r&&o()){let e=r;r=null,e()}};for(i.addEventListener("scroll",c),l=!1;!(l||a>=e.length);){let i=a++,l=e[i];n.innerHTML+=t(l,i),a%s==0&&(await H(150),o()||await new Promise(e=>r=e))}i.removeEventListener("scroll",c)}(),function(){l=!0,r&&(r(),r=null)}}($,({sha:e,mimeType:t,fileName:i},a)=>`<div> <img loading="lazy" onclick = 'goPicture(${a})' src = "${n}/sha/${e}/plugins/image/thumbnail?type=${t}"/> </div>`,a("#images-container"),a("#images"))):(a("#images-container").classList.add("is-hidden"),a("#images").innerHTML="")}async function q(){!async function(e){if(s(".playing").forEach(e=>e.classList.remove("playing")),e<0||e>=v.length)return;a("#video-player").classList.remove("is-hidden"),p=e;let{sha:t,mimeType:i,fileName:l}=v[e];a("#video-player").setAttribute("src",r?`${n}/sha/${t}/content?type=${i}`:`${n}/sha/${t}/plugins/video/small?type=${i}`),a("#video-player").setAttribute("type",i),a("#video-player").play(),a(`.video-${e}`).style.fontWeight="bold",a(`.video-${e}`).classList.add("playing"),K()}(p+1)}async function F(){!async function(e){if(s(".playing").forEach(e=>e.classList.remove("playing")),a("#audio-player").classList.remove("is-hidden"),e<0||e>=w.length)return;f=e;let{sha:t,mimeType:i,fileName:l}=w[e];a("#audio-player").setAttribute("src",`${n}/sha/${t}/content?type=${i}`),a("#audio-player").setAttribute("type",i),a("#audio-player").play(),a(`.audio-${e}`).style.fontWeight="bold",a(`.audio-${e}`).classList.add("playing"),K()}(f+1)}async function Y(e){let t=await fetch(`${n}/sha/${e}/content?type=text/json`);return await t.json()}let X=null;var B=L.map("mapid").setView([47.14378830236092,2.2063121440860023],4);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1IjoibHRlYXJubyIsImEiOiJjanY5ZXJqb2UwbzlyNGVtanpwMWRjMWJoIn0.vNNsUQ_cnIDfBLU3QHsuGQ"}).addTo(B);let Q=e=>{let t=B.getBounds(),i=t.getNorthWest(),n=t.getSouthEast();X={nw:{lat:i.lat,lng:i.lng},se:{lat:n.lat,lng:n.lng}}};B.on("zoom",Q),B.on("move",Q);function G(){if(window.location.hash&&window.location.hash.startsWith("#")&&"#null"!=window.location.hash&&"#undefined"!=window.location.hash){h=window.location.hash.substr(1),u=null,m=-1;let e=h.indexOf("-");e>=0&&(m=parseInt(h.substr(e+1)),h=h.substr(0,e)),a("#menu").classList.add("is-hidden")}}function K(){setTimeout(()=>{a("#banner-placeholder").style.height=`${a("#banner").offsetHeight}px`},5)}async function Z(){m<0?(a("#image-full-container").classList.add("is-hidden"),a("#images-container").classList.remove("is-hidden"),a("#banner").classList.remove("is-hidden"),a("#main").classList.remove("is-hidden")):(a("#image-full-container").classList.remove("is-hidden"),a("#images-container").classList.add("is-hidden"),a("#banner").classList.add("is-hidden"),a("#main").classList.add("is-hidden"));const e=D!=a("#display-order").value;D=a("#display-order").value,localStorage.setItem("SORT_ORDER",`${D}`);const t=k!=l;k=l;const i=I!=r;I=r;const s=E!=o;E=o;const d=M!=c;M=c,(d||i||t||e||h!=b)&&await P(h),(d||t||s||u!=T)&&await async function(e){if(a("#refName").innerText=e||"",a("#commitHistory").innerHTML="",!e)return null;let t=await(await fetch(`${n}/refs/${e}`)).json();if(!t)return null;let i=t.currentCommitSha,s=null,l=N("loading commit history...");for(;null!=i;){let e=await Y(i);if(!e)break;let t=new Date(e.commitDate),n=e.directoryDescriptorSha;if(n?(s||(s=n),a("#commitHistory").innerHTML+=`<div>${i.substr(0,7)} ${x(t)} - <a href='#' onclick='event.preventDefault() || goDirectory("${n}")'>${n.substr(0,7)}</a></div>`):a("#commitHistory").innerHTML+=`<div>${i.substr(0,7)} no directory descriptor in commit !</div>`,!o)break;i=e.parentSha}return l(),s}(u),a("#video-player").classList.add("is-hidden"),$.length||a("#images-container").classList.add("is-hidden"),m!=S&&await async function(e){if(a("#image-full-aligner").innerHTML="",e<0)return;let{sha:t,mimeType:i,fileName:s}=$[e],l=I?`${n}/sha/${t}/content?type=${i}`:`${n}/sha/${t}/plugins/image/medium?type=${i}`;a("#image-full-aligner").innerHTML+=`<a style='width:100%;height:100%;display:flex;align-items:center;justify-content: center;' href='${n}/sha/${t}/content?type=${i}'><img loading="lazy" class='image-full' src='${l}'/></a>`}(m),b=h,T=u,S=m,K()}window.addEventListener("load",async()=>{let e=await fetch(`${n}/refs`),t=await e.json();a("#refs-list").innerHTML=t.map(e=>`<div><a href='#' onclick='event.preventDefault() || goRef("${e}")'>${e}</a></div>`).join("");let i=await fetch("https://home.lteconsulting.fr/well-known/v1/me");a("#userId").innerText=(await i.json()).uuid}),a("#fullScreen").addEventListener("click",e=>{e.preventDefault(),a("body").webkitRequestFullScreen()}),a("#extended").addEventListener("change",()=>{l=!!a("#extended").checked,localStorage.setItem("EXTENDED",`${l}`),Z()}),a("#stream-raw-video").addEventListener("change",()=>{r=!!a("#stream-raw-video").checked,localStorage.setItem("STREAM_RAW_VIDEO",`${r}`),Z()}),a("#show-unliked-items").addEventListener("change",()=>{c=!!a("#show-unliked-items").checked,localStorage.setItem("SHOW_UNLIKED_ITEMS",`${c}`),Z()}),a("#show-full-commit-history").addEventListener("change",()=>{o=!!a("#show-full-commit-history").checked,localStorage.setItem("SHOW_FULL_COMMIT_HISTORY",`${o}`),Z()}),a("#display-order").addEventListener("change",()=>{Z()}),a("#audio-player").addEventListener("ended",()=>{F()}),a("#video-player").addEventListener("ended",()=>{q()}),a("#toggleExtSearch").addEventListener("click",e=>{a("#extSearch").classList.toggle("is-hidden"),B.invalidateSize(!0),e.preventDefault(),K()}),a("#playlist-name").addEventListener("input",()=>{localStorage.setItem("playlist-name",a("#playlist-name").value)}),a("#playlist-name").value=localStorage.getItem("playlist-name")||"favorites",a("#youtube-download-button").addEventListener("click",()=>{let e=a("#youtube-download-url").value;const t=new Headers;t.set("Content-Type","application/json"),fetch(`${n}/plugins/youtube/fetch`,{headers:t,method:"post",body:JSON.stringify({url:e})})}),window.onpopstate=function(e){e.state?(h=e.state.currentDirectoryDescriptorSha,u=e.state.currentClientId,m=e.state.currentPictureIndex||0,u||a("#menu").classList.remove("is-hidden"),Z()):(G(),Z())},history.state?(h=history.state.currentDirectoryDescriptorSha,u=history.state.currentClientId,m=history.state.currentPictureIndex||0,u&&a("#menu").classList.add("is-hidden"),Z()):(G(),W(),Z())}]);